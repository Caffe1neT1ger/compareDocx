# Сравнение по содержимому (игнорирование стилей)

Программа сравнивает документы **по содержимому текста**, а не по стилям форматирования. Это означает, что абзацы с одинаковым текстом, но разными стилями будут распознаны как идентичные.

## Как это работает

### Нормализация текста

Перед сравнением все тексты нормализуются:

1. **Удаление лишних пробелов** - множественные пробелы заменяются одним
2. **Нормализация переносов строк** - все переносы заменяются пробелами
3. **Удаление специальных символов** - неразрывные пробелы и другие специальные символы форматирования
4. **Удаление пробелов в начале и конце** - trim текста

### Алгоритм сравнения

Программа использует многоуровневый подход:

1. **Нормализация текстов** - все абзацы нормализуются перед сравнением
2. **Создание отпечатков** - для быстрого поиска идентичных абзацев создаются "отпечатки" текста
3. **Сопоставление по содержимому** - абзацы сопоставляются по нормализованному тексту, а не по позиции или стилю
4. **Поиск похожих** - для несовпадающих абзацев выполняется поиск наиболее похожих по содержимому

## Примеры работы

### Пример 1: Одинаковый текст, разные стили

**Документ 1:**
```
[Стиль: "Заголовок 1", жирный, 18pt]
Настоящее техническое задание определяет требования
```

**Документ 2:**
```
[Стиль: "Обычный", обычный, 12pt]
Настоящее техническое задание определяет требования
```

**Результат:** ✅ **Идентичны** (100% схожесть)
- Тексты идентичны после нормализации
- Различия только в форматировании (стили, шрифты)
- В описании изменений: "изменено только форматирование"

### Пример 2: Одинаковый текст, разное форматирование внутри абзаца

**Документ 1:**
```
Настоящее **техническое** задание определяет требования
```

**Документ 2:**
```
Настоящее *техническое* задание определяет требования
```

**Результат:** ✅ **Идентичны** (100% схожесть)
- Тексты идентичны после нормализации
- Различия только в форматировании (жирный vs курсив)

### Пример 3: Разные стили, одинаковое содержимое

**Документ 1:**
```
[Стиль: "Мой_Заголовок"]
1. Общие положения
```

**Документ 2:**
```
[Стиль: "Heading 1"]
1. Общие положения
```

**Результат:** ✅ **Идентичны** (100% схожесть)
- Тексты идентичны
- Стили разные, но это не влияет на сравнение

### Пример 4: Разные пробелы, одинаковое содержимое

**Документ 1:**
```
Настоящее   техническое    задание
```

**Документ 2:**
```
Настоящее техническое задание
```

**Результат:** ✅ **Идентичны** (100% схожесть)
- После нормализации (удаление лишних пробелов) тексты идентичны

## Преимущества

1. **Независимость от стилей** - можно использовать любые стили, программа сравнивает только текст
2. **Устойчивость к форматированию** - изменения форматирования не влияют на результат сравнения
3. **Точность** - абзацы с одинаковым содержимым всегда распознаются как идентичные
4. **Гибкость** - можно применять разные стили к одному и тому же тексту в разных документах

## Ограничения

1. **Изменения в тексте** - если текст изменен, даже незначительно, это будет зафиксировано
2. **Порядок слов** - изменение порядка слов будет зафиксировано как изменение
3. **Регистр** - регистр букв сохраняется (можно изменить, раскомментировав строку в `_normalize_text`)

## Настройка

Если нужно изменить поведение нормализации, отредактируйте метод `_normalize_text` в файле `compare.py`:

```python
def _normalize_text(self, text: str) -> str:
    # Раскомментируйте для игнорирования регистра:
    # text = text.lower()
    
    # Добавьте свои правила нормализации
    ...
```

## Тестирование

Для проверки работы сравнения по содержимому:

1. Создайте два документа с одинаковым текстом, но разными стилями
2. Запустите сравнение
3. Проверьте, что абзацы распознаны как идентичные

Пример:
```bash
python main.py document_with_style1.docx document_with_style2.docx result.xlsx
```

